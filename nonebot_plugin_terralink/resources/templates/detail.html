{% extends "base.html" %}
{% import "macros.html" as macros with context %}

{% block content %}
<style>
    .detail-large-icon {
        max-width: 100px;
        max-height: 100px;
        image-rendering: pixelated;
        object-fit: contain;
        --frame-cnt: 1;
        object-view-box: inset(0 0 calc(100% - 100% / var(--frame-cnt)) 0);
    }
</style>

<div class="panel-header">
    <span class="panel-title">{{ data.name }}</span>
    <div style="text-align: right;">
        <div style="font-size: 12px; color: #aaa;">ID: {{ data.id }}</div>
        <div style="font-size: 12px; color: #aaa;">{{ data.mod }}</div>
    </div>
</div>

<!-- é¡¶éƒ¨ï¼šå¤§å›¾ + æè¿° + å±æ€§ -->
<div class="detail-top">
    <div class="col" style="width: 40%;">
        <!-- å¤§å›¾æ ‡å±•ç¤º -->
        <div
            style="background: #2b3055; border-radius: 8px; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100px;">
            {% if data.imagePath %}
            {% set frames = data.frameCount or 1 %}

            <img src="{{ to_img_url(data.imagePath) }}" class="detail-large-icon" style="--frame-cnt: {{ frames }};">
            {% else %}
            <span style="font-size: 40px;">?</span>
            {% endif %}
        </div>
        <!-- æè¿° -->
        {% if data.description and data.description != "None" %}
        <div class="detail-desc-box">
            {{ data.description }}
        </div>
        {% endif %}
    </div>

    <div style="flex: 1;">
        {% if data.stats %}
        <table class="stats-table">
            <tr>
                <td class="stat-name">ç±»å‹</td>
                <td class="stat-val">{{ data.type }}</td>
            </tr>
            {% if data.stats.damage > 0 %}
            <tr>
                <td class="stat-name">ä¼¤å®³</td>
                <td class="stat-val">{{ data.stats.damage }}</td>
            </tr>
            {% endif %}
            {% if data.stats.crit > 0 %}
            <tr>
                <td class="stat-name">æš´å‡»ç‡</td>
                <td class="stat-val">{{ data.stats.crit }}%</td>
            </tr>
            {% endif %}
            {% if data.stats.useTime > 0 %}
            <tr>
                <td class="stat-name">ä½¿ç”¨æ—¶é—´</td>
                <td class="stat-val">{{ data.stats.useTime }}</td>
            </tr>
            {% endif %}
            {% if data.stats.knockBack > 0 %}
            <tr>
                <td class="stat-name">å‡»é€€</td>
                <td class="stat-val">{{ "%.1f"|format(data.stats.knockBack) }}</td>
            </tr>
            {% endif %}
            {% if data.stats.defense > 0 %}
            <tr>
                <td class="stat-name">é˜²å¾¡åŠ›</td>
                <td class="stat-val">{{ data.stats.defense }}</td>
            </tr>
            {% endif %}
            <tr>
                <td class="stat-name">æœ€å¤§å †å </td>
                <td class="stat-val">{{ data.stats.maxStack }}</td>
            </tr>
            <!-- [Update] ä»·å€¼æ˜¾ç¤º -->
            <tr>
                <td class="stat-name">ä¹°å…¥ä»·æ ¼</td>
                <td class="stat-val">{{ format_coin(data.stats.value) }}</td>
            </tr>
            <!-- [Update] å–å‡ºä»·æ ¼ -->
            <tr>
                <td class="stat-name">å–å‡ºä»·æ ¼</td>
                <td class="stat-val">
                    <div>{{ format_coin((data.stats.value * 0.2)|int) }}</div>
                    <div style="font-size: 10px; color: #aaa; font-weight: normal; margin-top: 4px; font-style: italic; line-height: 1.2;">
                        * åŸºç¡€å”®ä»· (å—NPCå¿«ä¹åº¦å½±å“)
                    </div>
                </td>
            </tr>
        </table>
        {% endif %}
    </div>
</div>

<!-- è·å–æ–¹å¼ï¼šæ‰è½/å”®å– -->
{% if data.droppedBy or data.soldBy %}
<div class="section-title">è·å–æ¥æº</div>
<div class="grid-container">
    {% for npc in data.droppedBy %}
    <div class="source-chip">
        <span>âš”ï¸ {{ npc.name }}</span>
    </div>
    {% endfor %}

    {% for npc in data.soldBy %}
    <div class="source-chip" style="border-color: #ffce45;">
        <span>ğŸ’° {{ npc.name }}</span>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- ç®€æ˜“åˆæˆé¢„è§ˆ (Query æ¥å£è¿”å›çš„ç®€å•é…æ–¹) -->
{% if data.recipes %}
<div class="section-title">åˆæˆæ–¹å¼ (ç®€ç•¥)</div>
<div class="col">
    {% for recipe in data.recipes %}
    <div class="recipe-row">
        <!-- åˆ¶ä½œç«™ -->
        <div class="recipe-station">
            {% if recipe.stations %}
            {{ macros.item_slot(recipe.stations[0], show_name=True) }}
            {% else %}
            <span style="font-size: 12px; color: #aaa;">å¾’æ‰‹</span>
            {% endif %}
        </div>

        <!-- ææ–™ -->
        <div class="recipe-ingredients">
            {% for ing in recipe.ingredients %}
            {{ macros.item_slot(ing, show_name=False) }}
            {% endfor %}
        </div>

        <div class="recipe-arrow">â¨</div>

        <!-- ç»“æœ -->
        <div class="recipe-result">
            {{ macros.item_slot({'name': recipe.resultName, 'stack': recipe.resultCount, 'imagePath': data.imagePath,
            'frameCount': data.frameCount}, show_name=False) }}
        </div>
    </div>
    {% endfor %}

    <div style="text-align: center; font-size: 12px; color: #aaa; margin-top: 5px;">
        ä½¿ç”¨ /recipe {{ data.id }} æŸ¥çœ‹å®Œæ•´åˆæˆæ ‘
    </div>
</div>
{% endif %}

{% endblock %}